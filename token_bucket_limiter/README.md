# 令牌桶限流算法

## 算法介绍

令牌桶限流算法是一种常用的限流算法。它通过控制产生令牌的速率来控制请求的速率。每个请求都需要消耗一个令牌才能通过。如果没有足够的令牌，则请求将被拒绝。

## 结构

在Go中，我们可以使用结构体来实现令牌桶限流器。下面是一个简单的例子：

```go
type TokenBucketLimiter struct {
	mu        sync.Mutex    // 互斥锁
	rate      time.Duration // 产生令牌速率
	capacity  int           // 桶容量
	remaining int           // 剩余令牌数量
	last      time.Time     // 上次产生令牌时间
}
```
## 方法及参数
我们可以定义一个NewTokenBucketLimiter函数来创建一个新的令牌桶限流器。该函数接受两个参数：rate和capacity，分别表示产生令牌的速率和桶容量。

此外，我们还需要定义一个allow()方法来判断是否允许通过请求。该方法不需要任何参数。

## 实现思路
在创建新的令牌桶限流器时，我们需要初始化结构体中的各个字段。然后，在调用allow()方法时，我们首先计算自上次调用以来产生了多少个新的令牌，并更新剩余令牌数量。如果剩余数量超过容量，则将其设置为容量值。

接下来，判断剩余数量是否大于0. 如果是，则减去1并返回true；否则返回false。

## 测试实现思路
测试代码首先创建一个新的令牌桶限流器，并在循环中调用allow()方法，检查是否允许通过请求。如果在容量范围内，allow()方法应返回true；当超出容量时，应返回false。

接下来，测试代码等待一段时间（与产生令牌速率相同），然后再次调用allow()方法。由于此时已经产生了新的令牌，因此allow()方法应返回true。
